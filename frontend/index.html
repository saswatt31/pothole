<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>PotholeAI — Road Damage Detector</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Bebas+Neue&display=swap" rel="stylesheet"/>
<style>
  :root {
    --bg: #0a0a0a;
    --surface: #111;
    --border: #222;
    --accent: #f0b429;
    --accent2: #e03d3d;
    --text: #e8e8e8;
    --muted: #555;
    --font-mono: 'Space Mono', monospace;
    --font-display: 'Bebas Neue', sans-serif;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font-mono);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* Header */
  header {
    border-bottom: 1px solid var(--border);
    padding: 1.5rem 2.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
  }
  .logo-dot {
    width: 10px; height: 10px;
    background: var(--accent);
    border-radius: 50%;
    animation: pulse 2s infinite;
  }
  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.4; transform: scale(0.8); }
  }
  header h1 {
    font-family: var(--font-display);
    font-size: 2.2rem;
    letter-spacing: 0.1em;
    color: var(--accent);
  }
  header span {
    font-size: 0.7rem;
    color: var(--muted);
    border: 1px solid var(--border);
    padding: 2px 8px;
    margin-left: auto;
  }

  /* Main layout */
  main {
    flex: 1;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
    height: calc(100vh - 72px);
  }

  .panel {
    border-right: 1px solid var(--border);
    padding: 2rem;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    overflow-y: auto;
  }
  .panel:last-child { border-right: none; }

  .panel-label {
    font-size: 0.65rem;
    letter-spacing: 0.2em;
    color: var(--muted);
    text-transform: uppercase;
    border-bottom: 1px solid var(--border);
    padding-bottom: 0.75rem;
  }

  /* Drop zone */
  .drop-zone {
    border: 1px dashed var(--border);
    border-radius: 2px;
    padding: 3rem 2rem;
    text-align: center;
    cursor: pointer;
    transition: border-color 0.2s, background 0.2s;
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    position: relative;
    overflow: hidden;
  }
  .drop-zone::before {
    content: '';
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(
      45deg,
      transparent,
      transparent 10px,
      rgba(255,255,255,0.01) 10px,
      rgba(255,255,255,0.01) 20px
    );
  }
  .drop-zone:hover, .drop-zone.dragover {
    border-color: var(--accent);
    background: rgba(240,180,41,0.03);
  }
  .drop-zone svg {
    color: var(--muted);
    transition: color 0.2s;
  }
  .drop-zone:hover svg { color: var(--accent); }
  .drop-zone p {
    font-size: 0.75rem;
    color: var(--muted);
    line-height: 1.6;
  }
  .drop-zone p strong {
    color: var(--accent);
    display: block;
    font-size: 0.85rem;
  }

  /* Preview image in upload panel */
  #preview-img {
    width: 100%;
    border-radius: 2px;
    border: 1px solid var(--border);
    display: none;
  }

  /* Button */
  .btn {
    background: var(--accent);
    color: #000;
    border: none;
    padding: 0.9rem 2rem;
    font-family: var(--font-mono);
    font-weight: 700;
    font-size: 0.8rem;
    letter-spacing: 0.1em;
    cursor: pointer;
    text-transform: uppercase;
    transition: opacity 0.2s, transform 0.1s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }
  .btn:hover { opacity: 0.85; }
  .btn:active { transform: scale(0.98); }
  .btn:disabled { opacity: 0.4; cursor: not-allowed; }

  /* Result panel */
  .result-area {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid var(--border);
    border-radius: 2px;
    overflow: hidden;
    position: relative;
    min-height: 300px;
    background: #080808;
  }
  .result-area img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: none;
  }
  .result-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
    color: var(--muted);
    font-size: 0.7rem;
    letter-spacing: 0.1em;
    text-align: center;
  }

  /* Status bar */
  .status-bar {
    font-size: 0.7rem;
    color: var(--muted);
    padding: 0.5rem 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  .status-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--muted);
  }
  .status-dot.active { background: var(--accent); }
  .status-dot.error { background: var(--accent2); }

  /* Loader */
  .loader {
    display: none;
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.75);
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 1rem;
    z-index: 10;
  }
  .loader.show { display: flex; }
  .spinner {
    width: 36px; height: 36px;
    border: 2px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loader p {
    font-size: 0.7rem;
    color: var(--accent);
    letter-spacing: 0.15em;
    text-transform: uppercase;
  }

  /* Download btn */
  .btn-outline {
    background: transparent;
    color: var(--text);
    border: 1px solid var(--border);
    padding: 0.7rem 1.5rem;
    font-family: var(--font-mono);
    font-size: 0.75rem;
    letter-spacing: 0.1em;
    cursor: pointer;
    text-transform: uppercase;
    transition: border-color 0.2s, color 0.2s;
    display: none;
    align-items: center;
    gap: 0.5rem;
  }
  .btn-outline:hover { border-color: var(--accent); color: var(--accent); }

  input[type="file"] { display: none; }

  @media (max-width: 768px) {
    main { grid-template-columns: 1fr; height: auto; }
    .panel { border-right: none; border-bottom: 1px solid var(--border); }
  }
</style>
</head>
<body>

<header>
  <div class="logo-dot"></div>
  <h1>PotholeAI</h1>
  <span>YOLOv8 · ROAD DAMAGE DETECTION</span>
</header>

<main>
  <!-- Upload Panel -->
  <div class="panel">
    <div class="panel-label">01 / Upload Image</div>

    <div class="drop-zone" id="drop-zone">
      <svg width="40" height="40" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
          d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
      </svg>
      <p><strong>Click or drag & drop</strong>JPG, PNG, WEBP supported</p>
    </div>

    <img id="preview-img" alt="Preview"/>
    <input type="file" id="file-input" accept="image/*"/>

    <div class="status-bar">
      <div class="status-dot" id="status-dot"></div>
      <span id="status-text">Waiting for image...</span>
    </div>

    <button class="btn" id="detect-btn" disabled>
      <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M9 3H5a2 2 0 00-2 2v4m6-6h10a2 2 0 012 2v4M9 3v18m0 0h10a2 2 0 002-2V9M9 21H5a2 2 0 01-2-2V9m0 0h18"/>
      </svg>
      Run Detection
    </button>
  </div>

  <!-- Result Panel -->
  <div class="panel">
    <div class="panel-label">02 / Detection Result</div>

    <div class="result-area" id="result-area">
      <div class="loader" id="loader">
        <div class="spinner"></div>
        <p>Analyzing road...</p>
      </div>

      <div class="result-placeholder" id="result-placeholder">
        <svg width="48" height="48" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: #333">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1"
            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1"
            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
        </svg>
        Result will appear here
      </div>

      <img id="result-img" alt="Detection result"/>
    </div>

    <button class="btn-outline" id="download-btn">
      <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
      </svg>
      Download Result
    </button>
  </div>
</main>

<script>
  // ⚠️ Change this to your deployed backend URL
  const API_URL = "http://localhost:8000";

  const dropZone = document.getElementById('drop-zone');
  const fileInput = document.getElementById('file-input');
  const previewImg = document.getElementById('preview-img');
  const detectBtn = document.getElementById('detect-btn');
  const resultImg = document.getElementById('result-img');
  const resultPlaceholder = document.getElementById('result-placeholder');
  const loader = document.getElementById('loader');
  const statusDot = document.getElementById('status-dot');
  const statusText = document.getElementById('status-text');
  const downloadBtn = document.getElementById('download-btn');

  let selectedFile = null;

  function setStatus(msg, state = 'idle') {
    statusText.textContent = msg;
    statusDot.className = 'status-dot' + (state === 'active' ? ' active' : state === 'error' ? ' error' : '');
  }

  function handleFile(file) {
    if (!file || !file.type.startsWith('image/')) {
      setStatus('Invalid file. Please upload an image.', 'error');
      return;
    }
    selectedFile = file;
    const url = URL.createObjectURL(file);
    previewImg.src = url;
    previewImg.style.display = 'block';
    dropZone.style.display = 'none';
    detectBtn.disabled = false;
    setStatus(`Ready: ${file.name}`, 'active');
    // Reset results
    resultImg.style.display = 'none';
    resultPlaceholder.style.display = 'flex';
    downloadBtn.style.display = 'none';
  }

  dropZone.addEventListener('click', () => fileInput.click());
  fileInput.addEventListener('change', e => handleFile(e.target.files[0]));

  dropZone.addEventListener('dragover', e => {
    e.preventDefault();
    dropZone.classList.add('dragover');
  });
  dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
  dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.classList.remove('dragover');
    handleFile(e.dataTransfer.files[0]);
  });

  detectBtn.addEventListener('click', async () => {
    if (!selectedFile) return;

    loader.classList.add('show');
    detectBtn.disabled = true;
    setStatus('Sending to model...', 'active');

    try {
      const formData = new FormData();
      formData.append('file', selectedFile);

      const res = await fetch(`${API_URL}/detect`, {
        method: 'POST',
        body: formData,
      });

      if (!res.ok) throw new Error(`Server error: ${res.status}`);

      const blob = await res.blob();
      const imgUrl = URL.createObjectURL(blob);

      resultImg.src = imgUrl;
      resultImg.style.display = 'block';
      resultPlaceholder.style.display = 'none';

      // Setup download
      downloadBtn.style.display = 'flex';
      downloadBtn.onclick = () => {
        const a = document.createElement('a');
        a.href = imgUrl;
        a.download = `pothole_detected_${Date.now()}.jpg`;
        a.click();
      };

      setStatus('Detection complete ✓', 'active');
    } catch (err) {
      setStatus(`Error: ${err.message}`, 'error');
      console.error(err);
    } finally {
      loader.classList.remove('show');
      detectBtn.disabled = false;
    }
  });
</script>
</body>
</html>
